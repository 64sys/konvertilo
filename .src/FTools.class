' Gambas class file

Public strFileExt As String

Public Sub Run(strExt As String)

  Dim pnl As Panel
  Dim chk As CheckBox
  Dim cmo As ComboBox
  Dim lbl As Label
  Dim swb As SwitchButton
  Dim txo As TextBox
  Dim intR As Integer
  Dim intL As Integer
  Dim strTitle As String
  Dim strToolName As String

  strFileExt = String.LCase(strExt)

  strTitle = ("Acciones para archivos")
  strTitle &= " "
  strTitle &= strFileExt

  Print strFileExt

  Me.Title = strTitle

  ' Creacion del checkbox para seleccionar la herramienta a aplicar
  ' con un modificador para el caso que sea necesario

  For intR = 0 To MStarter.stxToolsExt.Max

    If InStr(MStarter.stxToolsExt[intR], strFileExt) > 0 Then
      pnl = New Panel(pnlTools) As "pnl"
      With pnl
        .Name = "pnl" & ":" & strFileExt & ":" & CStr(intR)
        .Height = 28
        .Width = 350
        .Arrangement = Arrange.Horizontal

      End With

      chk = New CheckBox(pnl) As "chk"
      With chk
        .Name = "chk" & ":" & strFileExt & ":" & CStr(intR)
        .Text = MStarter.stxToolsName[intR]
        .Tag = MStarter.stxToolsName[intR]
        Print MStarter.stxToolsName[intR]
        .Height = 28
        .Width = 250
        .Tooltip = MStarter.stxToolsDesc[intR]
        .Value = Settings[MStarter.stxToolsName[intR] &/ strFileExt, False]

      End With

      ' Aca algunas particularidades de modificadores de estilo libre o de seleccion de valores preestablecidos

      strToolName = MStarter.stxToolsName[intR]

      Print strToolName

      Select strToolName

        Case "PNG>OCR-Text", "JPEG>OCR-Text", "PDF>OCR-Text"
          lbl = New Label(pnl)
          With lbl
            .Name = "lbl" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 40
            .Alignment = Align.Right
            .Expand = True
            .Text = ("Idioma") & " "
          End With

          cmo = New ComboBox(pnl) As "mod"
          With cmo
            .Name = "cmo" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 100
            For intL = 0 To MStarter.stxOCRLang.Max
              .Add(MStarter.stxOCRLang[intL])
            Next
            .Text = Settings[strFileExt &/ MStarter.stxToolsName[intR], ""]

          End With
        Case "TXT>OGG"
          lbl = New Label(pnl)
          With lbl
            .Name = "lbl" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 40
            .Alignment = Align.Right
            .Expand = True
            .Text = ("Idioma") & " "
          End With

          cmo = New ComboBox(pnl) As "mod"
          With cmo
            .Name = "cmo" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 100
            For intL = 0 To Split("en-GB:de-DE:es-ES:fr-FR:it-IT", ":").Max
              .Add(Split("en-GB:de-DE:es-ES:fr-FR:it-IT", ":")[intL])
            Next
            .Text = Settings[strFileExt &/ MStarter.stxToolsName[intR], ""]

          End With

        Case "PDF>Image", "Image-Convert"
          lbl = New Label(pnl)
          With lbl
            .Name = "lbl" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 40
            .Alignment = Align.Right
            .Expand = True
            .Text = ("Formato") & " "
          End With

          cmo = New ComboBox(pnl) As "mod"
          With cmo
            .Name = "cmo" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 100
            For intL = 0 To MStarter.stxImageOFormat.Max
              .Add(String.LCase(MStarter.stxImageOFormat[intL]))
            Next
            .Text = Settings[strFileExt &/ MStarter.stxToolsName[intR], ""]
          End With

        Case "Media>Arrange"
          lbl = New Label(pnl)
          With lbl
            .Name = "lbl" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 40
            .Alignment = Align.Right
            .Expand = True
            .Text = ("Mover") & " "
          End With

          swb = New SwitchButton(pnl) As "mod"
          With swb
            .Name = "swb" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 100
            .Value = Settings[strFileExt &/ MStarter.stxToolsName[intR], False]
          End With

        Case Else
          lbl = New Label(pnl)
          With lbl
            .Name = "lbl" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 40
            .Alignment = Align.Right
            .Expand = True
            .Text = ""
          End With

          txo = New TextBox(pnl) As "mod"
          With txo
            .Name = "txo" & ":" & MStarter.stxToolsName[intR] & ":" & strFileExt & ":" & CStr(intR)
            .Height = 28
            .Width = 100
            .Text = Settings[strFileExt &/ MStarter.stxToolsName[intR], ""]
          End With
      End Select

    Endif
  Next

  Me.ShowModal()

End

Public Sub btnOK_Click()

  If SaveSettings() = 1 Then
    Me.Close
  Endif

End

Public Sub btnCancel_Click()

  Me.Close

End

Public Function SaveSettings() As Integer

  Dim objPanel As Object
  Dim pnl As Panel
  Dim objBox As Object
  Dim strBox As String
  Dim strTool As String

  For Each objPanel In pnlTools.Children
    If Object.Type(objPanel) = "Panel" Then

      pnl = objPanel

      For Each objBox In pnl.Children

        Select Object.Type(objBox)
          Case "CheckBox"

            Print objBox.Name & "\t" & objBox.Text & "\t" & objBox.Tag

            strTool = objBox.Tag

            Select objBox.Value
              Case "0", 0, False
                Settings[strTool &/ strFileExt] = ""

              Case True, "-1", -1, True
                Settings[strTool &/ strFileExt] = True

            End Select

          Case "SwitchButton"
            strBox = Split(objBox.Name, ":")[2] &/ Split(objBox.Name, ":")[1]
            Select objBox.Value
              Case "0", 0, False
                Settings[strBox] = ""
              Case "-1", -1, True
                Settings[strBox] = True
            End Select

          Case "ComboBox", "TextBox"
            strBox = Split(objBox.Name, ":")[2] &/ Split(objBox.Name, ":")[1]
            Settings[strBox] = objBox.Text

          Case "ValueBox"
            strBox = Split(objBox.Name, ":")[2] &/ Split(objBox.Name, ":")[1]
            Settings[strBox] = objBox.Value
        End Select
      Next
    Endif
  Next

  Settings.Save

  Return 1

End
